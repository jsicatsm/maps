<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Trip Planner Map</title>
  <!-- Include Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css">
  <style>
    /* Set the height of the map container */
    #map {
      height: 600px;
      width: 100%;
    }
    /* Basic styling for the form below the map */
    #formContainer {
      margin-top: 10px;
    }
    label {
      display: inline-block;
      width: 60px;
    }
    input {
      margin-bottom: 10px;
    }
  </style>
</head>
<body>
  <h1>Trip Planner Map</h1>
  
  <!-- Map container -->
  <div id="map"></div>
  
  <!-- Form for capturing date and notes -->
  <div id="formContainer">
    <label for="date">Date:</label>
    <input type="date" id="date">
    <br>
    <label for="notes">Notes:</label>
    <input type="text" id="notes" placeholder="Enter notes here">
    <br>
    <button id="savePin">Save Pin</button>
  </div>

 <!--  Add a Select Element in HTML: -->
<div id="filterContainer">
  <label for="filterDate">Filter by Date:</label>
  <select id="filterDate">
    <option value="">--Select Date--</option>
    <!-- Options will be dynamically populated -->
  </select>
  <button id="applyFilter">Apply Filter</button>
</div>
  
  <!-- Include Leaflet JS -->
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  
  <!-- Your JavaScript logic -->
  <script>
    // 1. Initialize the map and set a default view:
    var map = L.map('map').setView([20, 0], 2); // Adjust center and zoom level as needed.

    // 2. Load OpenStreetMap tiles via Leaflet:
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    // 3. Prepare a temporary marker variable:
    var tempMarker;

    // 4. Listen for clicks on the map to place a temporary marker:
    map.on('click', function(e) {
      // Remove previous temporary marker if it exists
      if (tempMarker) {
        map.removeLayer(tempMarker);
      }
      // Add a new marker at the clicked location
      tempMarker = L.marker(e.latlng).addTo(map);
    });

    // 5. Function to save a marker with the associated date and notes:
    document.getElementById('savePin').addEventListener('click', function() {
      if (!tempMarker) {
        alert("Please click on the map to select a location!");
        return;
      }
      var date = document.getElementById('date').value;
      var notes = document.getElementById('notes').value;
      if (!date) {
        alert("Please select a date");
        return;
      }
      
      // Bind a popup to the marker with the saved info:
      tempMarker.bindPopup("<b>Date:</b> " + date + "<br><b>Notes:</b> " + notes).openPopup();

      // Save marker data into local storage (for persistence on reload):
      var savedPins = JSON.parse(localStorage.getItem('pins')) || [];
      var pinData = {
        lat: tempMarker.getLatLng().lat,
        lng: tempMarker.getLatLng().lng,
        date: date,
        notes: notes
      };
      savedPins.push(pinData);
      localStorage.setItem('pins', JSON.stringify(savedPins));

      // Clear the temporary marker variable so a new one can be placed:
      tempMarker = null;
      document.getElementById('date').value = "";
      document.getElementById('notes').value = "";
      alert("Pin saved!");
    });

    // 6. Load and display saved markers when the page loads:
    window.addEventListener('load', function() {
      var savedPins = JSON.parse(localStorage.getItem('pins')) || [];
      savedPins.forEach(function(pin) {
        var marker = L.marker([pin.lat, pin.lng]).addTo(map);
        marker.bindPopup("<b>Date:</b> " + pin.date + "<br><b>Notes:</b> " + pin.notes);
      });
    });

// Function to populate the filter dropdown with unique dates
function populateFilter() {
  var savedPins = JSON.parse(localStorage.getItem('pins')) || [];
  var dates = [...new Set(savedPins.map(pin => pin.date))];
  var filterSelect = document.getElementById('filterDate');
  filterSelect.innerHTML = '<option value="">--Select Date--</option>';
  dates.forEach(function(date) {
    var option = document.createElement('option');
    option.value = date;
    option.textContent = date;
    filterSelect.appendChild(option);
  });
}

// Call populateFilter on page load
window.addEventListener('load', populateFilter);

// Event listener for applying filter
document.getElementById('applyFilter').addEventListener('click', function() {
  var selectedDate = document.getElementById('filterDate').value;
  var savedPins = JSON.parse(localStorage.getItem('pins')) || [];
  
  // Remove any existing polylines (if you’re storing them globally)
  if(window.currentPolyline) {
    map.removeLayer(window.currentPolyline);
  }
  
  if (!selectedDate) {
    alert("Please select a date to filter");
    return;
  }
  
  // Filter pins by selected date
  var filteredPins = savedPins.filter(pin => pin.date === selectedDate);
  
  // Create an array of coordinates for polyline
  var latlngs = filteredPins.map(pin => [pin.lat, pin.lng]);
  
  // Optionally, clear current markers and re-add filtered ones
  // For now, we’ll just draw a line connecting them
  if (latlngs.length > 1) {
    window.currentPolyline = L.polyline(latlngs, {color: 'blue'}).addTo(map);
    map.fitBounds(window.currentPolyline.getBounds());
  } else if (latlngs.length === 1) {
    map.setView(latlngs[0], 14);  // Zoom in on single marker
  }
});

    
  </script>
</body>
</html>
